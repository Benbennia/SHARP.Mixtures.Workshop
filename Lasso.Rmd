---
title: "Lasso"
author: "Ahlam Abuawad"
date: "7/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(caret)
library(Hmisc)
library(glmnet)
```

# Dataset

```{r}
# Importing Dataset
study_pop = read_csv("./data/studypop.csv") %>% 
  select(SEQN, SDDSRVYR, TELOMEAN, everything())

# Checking Variables for Amount Missing, etc.
describe(study_pop)
```

# Lasso

```{r}
data_lasso = study_pop %>% 
  select(everything(), -SEQN, -SDDSRVYR) %>% 
  drop_na

## visualizing variables
x = model.matrix(TELOMEAN~., data_lasso)[,-(1:2)]
y = data_lasso$TELOMEAN

#featurePlot(x = x,
           # y = y,
           # between = list(x = 1, y = 1), 
           # type = c("g", "p", "smooth"))
```

## Creating Testing and Training Sets

```{r train and test set}
# For reproducibility set seed
set.seed(1)

# create train and test datasets
train_set = data_lasso[sample(nrow(data_lasso), 80),]
test_set = data_lasso[!row.names(data_lasso) %in% row.names(train_set),]

# create a matrix model for train and test set
x_train = model.matrix(TELOMEAN ~., train_set)[,-(1:2)]
y_train = train_set$TELOMEAN

x_test = model.matrix(TELOMEAN ~., test_set)[,-(1:2)]
y_test = test_set$TELOMEAN

```

## Finding the Best Lambda Value

```{r lasso}
set.seed(2)
lasso = glmnet(x_train, y_train, alpha = 1)
#plot(lasso, xvar = "lambda")

# use cross-validation to find best lambda value
cv.lasso = cv.glmnet(x_train, y_train, alpha = 1)
plot(cv.lasso)
best_llambda = cv.lasso$lambda.min
best_llambda

# lasso model using best lambda value
lasso.mod = glmnet(x_train, y_train, alpha = 1, lambda = best_llambda)
coefficients_lasso = coef(lasso.mod)
coefficients_lasso

# prediction and MSE using train dataset
lasso.pred.train = predict(lasso.mod, s = best_llambda, newx = x_train)
lasso_MSE_train = mean((lasso.pred.train - y_train)^2)

# prediction and MSE using test dataset
lasso.pred = predict(lasso.mod, s = best_llambda, newx = x_test)
lasso_MSE_test = mean((lasso.pred - y_test)^2)
```

# Elastic Net

```{r}
set.seed(2)
elastic = glmnet(x_train, y_train, alpha = 0.5)
#plot(elastic, xvar = "lambda")

# use cross-validation to find best lambda value
cv.elastic = cv.glmnet(x_train, y_train, alpha = 0.5)
plot(cv.elastic)
best_elambda = cv.elastic$lambda.min
best_elambda

# elastic model using best lambda value
elastic.mod = glmnet(x_train, y_train, alpha = 0.5, lambda = best_elambda)
coefficients_elastic = coef(elastic.mod)
coefficients_elastic

# prediction and MSE using train dataset
elastic.pred.train = predict(elastic.mod, s = best_elambda, newx = x_train)
elastic_MSE_train = mean((elastic.pred.train - y_train)^2)

# prediction and MSE using test dataset
elastic.pred = predict(elastic.mod, s = best_elambda, newx = x_test)
elastic_MSE_test = mean((elastic.pred - y_test)^2)
```

## Comparing Lasso and Elastic Net

```{r}
# Table of MSE's
compare = cbind(as.vector(best_llambda), as.vector(lasso_MSE_test), as.vector(best_elambda), as.vector(elastic_MSE_test))
rownames(compare) = colnames(lasso_MSE_test); colnames(compare) = c("Lasso Lambda", "Lasso Test MSE", "Elastic Lambda", "Elastic Net Test MSE")
knitr::kable(compare, align = "c")
```